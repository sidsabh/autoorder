<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>AutoOrder Dashboard</title>
  <!-- Favicon -->
  <link rel="icon" href="../static/img/AutoOrder.png" type="image/png">
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="../static/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="../static/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Page plugins -->
  <!-- Argon CSS -->
  <link rel="stylesheet" href="../static/css/argon.css?v=1.2.0" type="text/css">
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
  <!-- Sidenav -->
  <nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
      <!-- Brand -->
      <div class="sidenav-header  align-items-center">
        <a class="navbar-brand" href="javascript:void(0)">
          <img src="../static/img/AutoOrder.png" class="navbar-brand-img" alt="...">
        </a>
      </div>
      <div class="navbar-inner">
        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
          <!-- Nav items -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="?"">
                <i class="ni ni-tv-2 text-primary"></i>
                <span class="nav-link-text">Dashboard</span>
              </a>
            </li>
          </ul>
          <!-- Divider -->
          <hr class="my-3">
          <!-- Heading -->
          <h6 class="navbar-heading p-0 text-muted">
            <span class="docs-normal">Links</span>
          </h6>
          <!-- Navigation -->
          <ul class="navbar-nav mb-md-3">
            <li class="nav-item">
              <a class="nav-link" href="https://www.autoordersystems.com/" target="_blank">
                <i class="ni ni-palette"></i>
                <span class="nav-link-text">AutoOrder Website</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://dashboard.stripe.com/dashboard" target="_blank">
                <i class="ni ni-spaceship"></i>
                <span class="nav-link-text">Stripe</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('auth.resetpassword') }}" target="_blank">
                <i class="ni ni-ui-04"></i>
                <span class="nav-link-text">Reset Password</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Topnav -->
    <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Navbar links -->
          <ul class="navbar-nav align-items-center  ml-md-auto ">
            <li class="nav-item d-xl-none">
                <!-- List group -->
                <div class="list-group list-group-flush">
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">

                <a href="#!" class="dropdown-item text-center text-primary font-weight-bold py-3">View all</a>
              </div>
            </li>
            <li class="nav-item dropdown">
          <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
            <li class="nav-item dropdown">
              <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="media align-items-center">
                  <span class="avatar avatar-sm rounded-circle">
                    <img src="../static/img/default2.png">
                  </span>
                  <div class="media-body  ml-2  d-none d-lg-block">
                    <span class="mb-0 text-sm  font-weight-bold"> {{ name }} </span>
                  </div>
                </div>
              </a>
              <div class="dropdown-menu  dropdown-menu-right ">
                <div class="dropdown-header noti-title">
                  <h6 class="text-overflow m-0">Welcome!</h6>
                </div>
                <!--
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-single-02"></i>
                  <span>My profile</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-settings-gear-65"></i>
                  <span>Settings</span>
                </a>
                <!--
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-calendar-grid-58"></i>
                  <span>Activity</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-support-16"></i>
                  <span>Support</span>
                </a>
                --> 
                <div class="dropdown-divider"></div>
                <a href="{{ url_for('main.index') }}"class="dropdown-item">
                  <i class="ni ni-user-run"></i>
                  <span>Logout</span>
                </a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Header  -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
    <!-- Page content -->
    <!-- Orders -->
    <title>Orders</title>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 50%;
            color: white
        }

        td,
        th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
    </style>
</head>

<body>
    <div id="app">
        <table border="1" style = "width:100%" style="margin: 0px;">
            <tr>
                <th>Phone Number</th>
                <th>Items</th>
                <th>Type</th>
                <th>Address</th>
                <th>Comments</th>
                <th>Timestamp</th>
                <th>Total</th>
                <th>Remove Order</th>
            </tr>
            <tr v-for="order in orders">
                <td><% order.from_num %></td>
                <td><% order.item_list %></td>
                <td><% order.method_of_getting_food %></td>
                <td><% order.address %></td>
                <td><% order.comments%></td>
                <td><% order.timestamp %></td>
                <td>$<% order.total %></td>
                <td><button v-on:click="removeOrder(order.timestamp, order.from_num)">Remove</button></td>
                <!--
                <td><% unixToHuman(order.timestamp) %></td>
                <td>
                    <ul>
                        <li v-for="item in order.items"><% item[0] %> - $<% item[1] %> </li>
                    </ul>
                </td>
              -->
            </tr>
        </table>
    </div>
    <script> 
      var app = new Vue({
        el: '#app',
        delimiters: ["<%", "%>"],
        data: {
          orders: []
        },
        created() {
          axios.get("/api/orders/poll")
            .then(res => {
              this.orders = res.data
            })
          setInterval(() => {
            axios.get("/api/orders/poll")
              .then(res => {
                this.orders = res.data
              })
          }, 3000);
        },
        methods: {
          unixToHuman: function (timestamp) {
            var date = new Date(timestamp * 1000);
            var hours = date.getHours();
            var minutes = "0" + date.getMinutes();
            var seconds = "0" + date.getSeconds();
            return formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
          },
          removeOrder: function (timestamp, from_num) {
            axios.post('/api/orders/remove', {
              timestamp: timestamp,
              from_num: from_num
            })
              .then(() => {
                axios.get("/api/orders/poll")
                  .then(res => {
                    this.orders = res.data
                  })
              })
          }
        }
      })
    </script>
  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="../static/vendor/jquery/dist/jquery.min.js"></script>
  <script src="../static/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../static/vendor/js-cookie/js.cookie.js"></script>
  <script src="../static/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
  <script src="../static/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
  <!-- Optional JS -->
  <script src="../static/vendor/chart.js/dist/Chart.min.js"></script>
  <script src="../static/vendor/chart.js/dist/Chart.extension.js"></script>
  <!-- Argon JS -->
  <script src="../static/js/argon.js?v=1.2.0"></script>
  <!-- Order JS -->
  <script src="../static/js/orderscript.js"></script>
</body>

</html>
